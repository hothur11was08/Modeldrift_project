version: "3.8"

services:
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_USER=credit_user
      - POSTGRES_PASSWORD=credit_pass
      - POSTGRES_DB=credit_db
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - appnet

  tfserving:
    image: tensorflow/serving:2.14.0
    ports:
      - "8501:8501"
    environment:
      - MODEL_NAME=your_model
    volumes:
      - ./models/your_model:/models/your_model
    command: >
      --rest_api_port=8501
      --model_name=${MODEL_NAME}
      --model_base_path=/models/${MODEL_NAME}
    networks:
      - appnet

  api:
    build:
      context: .
      dockerfile: infra/api/Dockerfile
    image: credit_project-api
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://credit_user:credit_pass@postgres:5432/credit_db
      - TFSERVING_URL=http://tfserving:8501
    depends_on:
      - postgres
      - tfserving
    networks:
      - appnet

volumes:
  pgdata:

networks:
  appnet:

